<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>打地鼠小游戏</title>
<style>
    body {
        text-align: center;
        background-color: #dff6f0;
        font-family: Arial, sans-serif;
    }
    h1 {
        margin-top: 20px;
    }
    #game {
        display: grid;
        grid-template-columns: repeat(3, 150px);
        grid-gap: 10px;
        justify-content: center;
        margin-top: 20px;
    }
    .hole {
        width: 150px;
        height: 150px;
        background-image: url("hole.png"); /* 地洞背景 */
        background-size: cover;
        border-radius: 10px;
        position: relative;
        overflow: hidden;
        cursor: pointer;
    }
    .mole {
        width: 100px;
        height: 100px;
        background-image: url("shushu.png"); /* 地鼠图片 */
        background-size: cover;
        position: absolute;
        bottom: -100px;
        left: 25px;
        transition: bottom 0.2s;
    }
    .up {
        bottom: 20px;
    }
    #info {
        margin-top: 15px;
        font-size: 18px;
    }
    #start {
        padding: 10px 20px;
        background-color: #28a745;
        border: none;
        border-radius: 5px;
        color: white;
        cursor: pointer;
        font-size: 16px;
    }
    #start:disabled {
        background-color: #aaa;
        cursor: not-allowed;
    }
</style>
</head>
<body>

<h1>🎯 打地鼠小游戏</h1>
<div id="info">
    分数：<span id="score">0</span>　
    剩余时间：<span id="time">60</span> 秒
</div>
<button id="start">开始游戏</button>

<div id="game"></div>

<audio id="hit-sound" src="hit2.wav" preload="auto"></audio>
<!-- <audio id="hit-sound" src="hit2.wav" preload="auto"></audio>
<audio id="hit-sound" src="hit2.wav" preload="auto"></audio> -->

<script>
    const gameContainer = document.getElementById("game");
    const scoreDisplay = document.getElementById("score");
    const timeDisplay = document.getElementById("time");
    const startBtn = document.getElementById("start");
    // const hitSound = document.getElementById("hit-sound");
    let hitIndex = 0;
    const hitSounds = [
    document.getElementById("hit1"),
    document.getElementById("hit2"),
    document.getElementById("hit3")
    ];

    let holes = [];
    let score = 0;
    let timeLeft = 60;
    let gameInterval;
    let moleTimeout;
    let moleSpeed = 2000;

    // 创建 9 个洞
    for (let i = 0; i < 9; i++) {
        let hole = document.createElement("div");
        hole.classList.add("hole");

        let mole = document.createElement("div");
        mole.classList.add("mole");

        mole.addEventListener("click", () => {
            if (mole.classList.contains("up")) {
                score++;
                scoreDisplay.textContent = score;
                mole.classList.remove("up");
                // hitSound.currentTime = 0;
                // hitSound.play();

                // 用新实例播放音效，避免被截断
                const sound = new Audio("hit2.wav");
                sound.play();
                // hitSounds[hitIndex].currentTime = 0;
                // hitSounds[hitIndex].play();
                // hitIndex = (hitIndex + 1) % hitSounds.length;
            }
        });

        hole.appendChild(mole);
        gameContainer.appendChild(hole);
        holes.push(mole);
    }

    function randomHole() {
        const index = Math.floor(Math.random() * holes.length);
        return holes[index];
    }

    function showMole() {
        const mole = randomHole();
        mole.classList.add("up");

        moleTimeout = setTimeout(() => {
            mole.classList.remove("up");
        }, 800);
    }

    function startGame() {
        score = 0;
        timeLeft = 60;
        scoreDisplay.textContent = score;
        timeDisplay.textContent = timeLeft;
        startBtn.disabled = true;

        gameInterval = setInterval(() => {
            timeLeft--;
            timeDisplay.textContent = timeLeft;
            if (timeLeft <= 0) {
                endGame();
            }
        }, 1000);

        const moleLoop = () => {
            if (timeLeft > 0) {
                showMole();
                // setTimeout(moleLoop, 1500);
                moleSpeed = Math.max(400, moleSpeed - 50); // 每次减少 10ms，最低 0.4 秒
                setTimeout(moleLoop, moleSpeed);
            }
        };
        moleLoop();
    }

    function endGame() {
        clearInterval(gameInterval);
        clearTimeout(moleTimeout);
        startBtn.disabled = false;
        alert(`游戏结束！你的得分是 ${score} 分`);
    }

    startBtn.addEventListener("click", startGame);
</script>

</body>
</html>